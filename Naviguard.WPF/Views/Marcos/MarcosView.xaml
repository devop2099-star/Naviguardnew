<UserControl x:Class="Naviguard.WPF.Views.Marcos.MarcosView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:cefSharp="clr-namespace:CefSharp.Wpf;assembly=CefSharp.Wpf"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="900"
             Background="White"
             Unloaded="UserControl_Unloaded">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="60"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="35"/>
        </Grid.RowDefinitions>

        <!-- Barra de herramientas superior -->
        <Border Grid.Row="0" Background="#F8FAFC" 
                BorderBrush="#E2E8F0" BorderThickness="0,0,0,1"
                CornerRadius="15,15,0,0">
            <Grid Margin="15,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Controles de navegación -->
                <StackPanel Orientation="Horizontal" Grid.Column="0" VerticalAlignment="Center">
                    <!-- Botón Atrás -->
                    <Button x:Name="BtnBack" ToolTip="Atrás" Click="BtnBack_Click"
                            Width="38" Height="38" Margin="0,0,10,0"
                            Style="{StaticResource IconButtonStyle}">
                        <Path Data="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" 
                              Fill="#031828" Width="18" Height="18" Stretch="Uniform"/>
                    </Button>
                    
                    <!-- Campo de URL -->
                    <TextBox x:Name="TxtUrl" Width="350" Height="38"
                             Style="{StaticResource RoundedTextBoxStyle}"
                             Text="{Binding CurrentUrl, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             Tag="Buscar o escribir URL"
                             KeyDown="TxtUrl_KeyDown"
                             VerticalContentAlignment="Center"/>
                    

                </StackPanel>

                <!-- Controles de grabación -->
                <StackPanel Orientation="Horizontal" Grid.Column="2" VerticalAlignment="Center">
                    <StackPanel.Resources>
                        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
                        <Style TargetType="Button" BasedOn="{StaticResource IconButtonStyle}">
                            <Setter Property="Width" Value="32"/>
                            <Setter Property="Height" Value="32"/>
                            <Setter Property="Margin" Value="4,0"/>
                        </Style>
                    </StackPanel.Resources>

                    <!-- Separador -->
                    <Rectangle Width="1" Height="24" Fill="#E2E8F0" Margin="0,0,8,0"/>

                    <!-- Botón Grabar (Visible cuando NO está grabando) -->
                    <Button x:Name="BtnStart" ToolTip="Iniciar Grabación de Macro" Click="BtnStart_Click">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource IconButtonStyle}">
                                <Setter Property="Width" Value="32"/>
                                <Setter Property="Height" Value="32"/>
                                <Setter Property="Margin" Value="4,0"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsRecording}" Value="True">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                        <Path Data="M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7Z" 
                              Fill="#DC2626" Width="20" Height="20" Stretch="Uniform"/>
                    </Button>

                    <!-- Botón Detener (Visible SOLO cuando está grabando) -->
                    <Button x:Name="BtnStop" ToolTip="Detener Grabación" Click="BtnStop_Click">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource IconButtonStyle}">
                                <Setter Property="Width" Value="32"/>
                                <Setter Property="Height" Value="32"/>
                                <Setter Property="Margin" Value="4,0"/>
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsRecording}" Value="True">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                        <Path Data="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M9,9V15H15V9" 
                              Fill="#334155" Width="20" Height="20" Stretch="Uniform"/>
                    </Button>

                    <!-- Botón Reproducir (Visible cuando NO está grabando) -->
                    <Button x:Name="BtnReplay" ToolTip="Reproducir Macro" Click="BtnReplay_Click">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource IconButtonStyle}">
                                <Setter Property="Width" Value="32"/>
                                <Setter Property="Height" Value="32"/>
                                <Setter Property="Margin" Value="4,0"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsRecording}" Value="True">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                        <Path Data="M10,16.5L16,12L10,7.5V16.5M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z" 
                              Fill="#2563EB" Width="20" Height="20" Stretch="Uniform"/>
                    </Button>

                    <Rectangle Width="8" Height="0"/>

                    <!-- Botón Marcar Login (Visible SOLO cuando está grabando) -->
                    <Button x:Name="BtnMarkCredentials" ToolTip="Marcar Credenciales de Acceso" 
                            Click="BtnMarkCredentials_Click">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource IconButtonStyle}">
                                <Setter Property="Width" Value="32"/>
                                <Setter Property="Height" Value="32"/>
                                <Setter Property="Margin" Value="4,0"/>
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsRecording}" Value="True">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                        <Path Data="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,5A3,3 0 1,1 9,8A3,3 0 0,1 12,5M15.6,15.6L15.2,16.8L12.4,15.2V19H11.6V15.2L8.8,16.8L8.4,15.6L11.2,14L12,13.6L12.8,14L15.6,15.6Z" 
                              Fill="#D97706" Width="20" Height="20" Stretch="Uniform"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Navegador -->
        <Border Grid.Row="1" Background="White" Margin="0">
            <cefSharp:ChromiumWebBrowser x:Name="BrowserControl"/>
        </Border>

        <!-- Barra de estado -->
        <Border Grid.Row="2" Background="#031828" CornerRadius="0,0,15,15">
            <Grid Margin="15,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock x:Name="TxtStatus" 
                           Text="{Binding StatusMessage}" 
                           Foreground="White" FontSize="13" FontWeight="Medium"
                           VerticalAlignment="Center"/>
                
                <TextBlock x:Name="TxtEventCount" Grid.Column="1"
                           Text="{Binding EventCount, StringFormat='Eventos: {0}'}" 
                           Foreground="#94A3B8" FontSize="13"
                           VerticalAlignment="Center"/>
            </Grid>
        </Border>
    </Grid>
</UserControl>
